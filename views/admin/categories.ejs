<div class="admin-categories">
  <h1>Qu·∫£n l√Ω danh m·ª•c</h1>
  
  <div class="category-form-card">
    <h2>Th√™m danh m·ª•c m·ªõi</h2>
    <form action="/admin/categories?_csrf=<%= csrfToken %>" method="post" class="category-form">
      <div class="form-row">
        <div class="form-group">
          <label for="name">T√™n danh m·ª•c *</label>
          <input type="text" id="name" name="name" placeholder="V√≠ d·ª•: Game Keys" required />
        </div>
        <div class="form-group">
          <label for="slug">Slug (URL) *</label>
          <input type="text" id="slug" name="slug" placeholder="game-keys" required />
          <small class="form-hint">Slug s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c t·∫°o t·ª´ t√™n n·∫øu ƒë·ªÉ tr·ªëng</small>
        </div>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn primary large">
          <span></span>
          Th√™m danh m·ª•c
        </button>
        <button type="reset" class="btn secondary">
          <svg class="icon-refresh" viewBox="0 0 512 512" width="16" height="16" aria-hidden="true" style="vertical-align:middle;margin-right:6px;"><path d="M492 8h-10c-6.627 0-12 5.373-12 12v110.627C426.929 57.261 347.224 8 256 8 123.228 8 14.824 112.338 8.31 243.493 7.971 250.311 13.475 256 20.301 256h10.016c6.353 0 11.646-4.949 11.977-11.293C48.157 132.216 141.097 42 256 42c82.862 0 154.737 47.077 190.289 116H332c-6.627 0-12 5.373-12 12v10c0 6.627 5.373 12 12 12h160c6.627 0 12-5.373 12-12V20c0-6.627-5.373-12-12-12zm-.301 248h-10.015c-6.352 0-11.647 4.949-11.977 11.293C463.841 380.158 370.546 470 256 470c-82.608 0-154.672-46.952-190.299-116H180c6.627 0 12-5.373 12-12v-10c0-6.627-5.373-12-12-12H20c-6.627 0-12 5.373-12 12v160c0 6.627 5.373 12 12 12h10c6.627 0 12-5.373 12-12V381.373C85.071 454.739 164.777 504 256 504c132.773 0 241.176-104.338 247.69-235.493.339-6.818-5.165-12.507-11.991-12.507z" fill="currentColor"></path></svg>
          ƒê·∫∑t l·∫°i
        </button>
      </div>
    </form>
  </div>
  
  <div class="categories-list-card">
    <h2>Danh s√°ch danh m·ª•c</h2>
    <% if (!categories || categories.length === 0) { %>
      <p class="muted">Ch∆∞a c√≥ danh m·ª•c n√†o. H√£y th√™m danh m·ª•c ƒë·∫ßu ti√™n!</p>
    <% } else { %>
      <div class="categories-table-wrapper">
        <table class="categories-table">
          <thead>
            <tr>
              <th>T√™n danh m·ª•c</th>
              <th>Slug</th>
              <th>S·ªë s·∫£n ph·∫©m</th>
              <th class="center">Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            <% categories.forEach(c => { %>
              <tr>
                <td>
                  <div class="category-cell">
                    <span class="category-icon-small">üìÅ</span>
                    <strong><%= c.name %></strong>
                  </div>
                </td>
                <td>
                  <code class="slug-code">/<%= c.slug %></code>
                </td>
                <td>
                  <span class="product-count-badge"><%= c.product_count || 0 %> s·∫£n ph·∫©m</span>
                </td>
                <td>
                  <div class="action-buttons">
                    <a class="btn small" href="/admin/categories/<%= c.id %>/edit" title="S·ª≠a">
                      ‚úèÔ∏è
                    </a>
                    <a class="btn small" href="/category/<%= c.slug %>" target="_blank" title="Xem">
                      üëÅÔ∏è
                    </a>
                    <form action="/admin/categories/<%= c.id %>/delete?_csrf=<%= csrfToken %>" method="post" onsubmit="return confirm('X√≥a danh m·ª•c n√†y? S·∫£n ph·∫©m trong danh m·ª•c s·∫Ω b·ªã g·ª° kh·ªèi danh m·ª•c.')">
                      <button class="btn small danger" type="submit" title="X√≥a">üóëÔ∏è</button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>
</div>

<style>
.admin-categories {
  max-width: 1400px;
  margin: 0 auto;
}

.category-form-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 30px;
  margin-bottom: 30px;
}

.category-form-card h2 {
  margin: 0 0 24px 0;
  font-size: 24px;
  color: var(--fg);
  border-bottom: 2px solid var(--green);
  padding-bottom: 12px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-group label {
  font-weight: 500;
  color: var(--fg);
  font-size: 14px;
}

.form-group input {
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.02);
  color: var(--fg);
  font-size: 14px;
  font-family: inherit;
  transition: all 0.2s;
}

.form-group input:focus {
  outline: none;
  border-color: var(--green);
  background: rgba(22, 163, 74, 0.05);
}

.form-hint {
  font-size: 12px;
  color: var(--muted);
}

.form-actions {
  display: flex;
  gap: 12px;
  padding-top: 20px;
  border-top: 1px solid var(--border);
}

.form-actions .btn.large {
  padding: 14px 28px;
  font-size: 16px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.categories-list-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 30px;
}

.categories-list-card h2 {
  margin: 0 0 24px 0;
  font-size: 24px;
  color: var(--fg);
  border-bottom: 2px solid var(--green);
  padding-bottom: 12px;
}

.categories-table-wrapper {
  overflow-x: auto;
}

.categories-table {
  width: 100%;
  border-collapse: collapse;
}

.categories-table th {
  padding: 12px;
  text-align: left;
  font-weight: 600;
  color: var(--fg);
  border-bottom: 2px solid var(--border);
  font-size: 14px;
}

.categories-table td {
  padding: 16px 12px;
  border-bottom: 1px solid var(--border);
}

.categories-table tbody tr:hover {
  background: rgba(255, 255, 255, 0.02);
}

.category-cell {
  display: flex;
  align-items: center;
  gap: 12px;
}

.category-icon-small {
  font-size: 20px;
}

.slug-code {
  background: rgba(255, 255, 255, 0.05);
  padding: 4px 8px;
  border-radius: 4px;
  font-family: monospace;
  font-size: 12px;
  color: var(--muted);
}

.product-count-badge {
  display: inline-block;
  padding: 4px 12px;
  background: rgba(22, 163, 74, 0.1);
  color: var(--green);
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
}

.action-buttons {
  display: flex;
  gap: 6px;
  justify-content: center;
}

.action-buttons .btn.small {
  padding: 6px 10px;
  font-size: 14px;
  min-width: 36px;
}

@media (max-width: 968px) {
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .categories-table-wrapper {
    overflow-x: scroll;
  }
}
</style>

<script>
// Auto-generate slug from name
document.getElementById('name').addEventListener('input', function() {
  const name = this.value;
  const slugInput = document.getElementById('slug');
  
  if (slugInput.value === '' || slugInput.dataset.autoGenerated === 'true') {
    const slug = name
      .toLowerCase()
      .normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '')
      .replace(/[^a-z0-9\s-]/g, '')
      .replace(/\s+/g, '-')
      .replace(/-+/g, '-')
      .trim();
    slugInput.value = slug;
    slugInput.dataset.autoGenerated = 'true';
  }
});

document.getElementById('slug').addEventListener('input', function() {
  this.dataset.autoGenerated = 'false';
});
</script>


