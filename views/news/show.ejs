<style>
/* Professional News Detail Page */
.news-detail-wrapper {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0;
}

.news-detail-layout {
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 40px;
  padding: 40px 20px;
}

/* Breadcrumbs */
.news-detail-breadcrumbs {
  padding: 20px 20px 0;
  max-width: 1200px;
  margin: 0 auto;
  font-size: 14px;
  color: var(--muted);
}

.news-detail-breadcrumbs a {
  color: var(--muted);
  text-decoration: none;
  transition: color 0.2s ease;
}

.news-detail-breadcrumbs a:hover {
  color: var(--green);
}

.news-detail-breadcrumbs span {
  margin: 0 8px;
  color: var(--muted);
}

/* Article Header */
.news-detail-header-section {
  padding: 50px 20px 40px;
  max-width: 1200px;
  margin: 0 auto;
  border-bottom: 2px solid var(--border);
  margin-bottom: 40px;
}

.news-detail-category {
  display: inline-block;
  padding: 6px 14px;
  background: linear-gradient(135deg, var(--green) 0%, #16a34a 100%);
  color: white;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  border-radius: 6px;
  margin-bottom: 20px;
}

.news-detail-title {
  font-size: 44px;
  font-weight: 900;
  margin: 0 0 24px 0;
  color: var(--fg);
  line-height: 1.25;
  letter-spacing: -1px;
}

.news-detail-meta {
  display: flex;
  align-items: center;
  gap: 24px;
  flex-wrap: wrap;
  padding: 20px 0;
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
  font-size: 14px;
  color: var(--muted);
}

.news-detail-meta-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

.news-detail-meta-item svg {
  flex-shrink: 0;
}

/* Featured Image */
.news-detail-image-section {
  margin-bottom: 50px;
}

.news-detail-image-wrapper {
  position: relative;
  width: 100%;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  border: 1px solid var(--border);
}

.news-detail-image {
  width: 100%;
  height: auto;
  max-height: 600px;
  object-fit: cover;
  display: block;
}

/* Article Content */
.news-detail-main {
  margin-bottom: 50px;
}

.news-detail-content {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 60px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  line-height: 1.95;
  font-size: 19px;
  color: var(--fg);
}

.news-detail-content p {
  margin: 0 0 28px 0;
  color: var(--fg);
  font-size: 19px;
  line-height: 1.95;
  text-align: justify;
  word-spacing: 0.05em;
}

.news-detail-content h1,
.news-detail-content h2,
.news-detail-content h3,
.news-detail-content h4,
.news-detail-content h5,
.news-detail-content h6 {
  margin: 48px 0 20px 0;
  color: var(--fg);
  font-weight: 800;
  line-height: 1.3;
  letter-spacing: -0.3px;
}

.news-detail-content h1 {
  font-size: 38px;
  border-bottom: 3px solid rgba(34, 197, 94, 0.3);
  padding-bottom: 16px;
  margin-top: 60px;
}

.news-detail-content h2 {
  font-size: 32px;
  margin-top: 52px;
}

.news-detail-content h3 {
  font-size: 28px;
  margin-top: 44px;
}

.news-detail-content ul,
.news-detail-content ol {
  margin: 0 0 28px 0;
  padding-left: 36px;
  color: var(--fg);
}

.news-detail-content li {
  margin: 14px 0;
  line-height: 1.95;
  font-size: 19px;
}

.news-detail-content strong {
  color: var(--green);
  font-weight: 700;
}

.news-detail-content a {
  color: var(--green);
  text-decoration: none;
  border-bottom: 2px solid rgba(34, 197, 94, 0.3);
  transition: all 0.3s ease;
  font-weight: 500;
}

.news-detail-content a:hover {
  color: #22c55e;
  border-bottom-color: var(--green);
}

.news-detail-content blockquote {
  margin: 32px 0;
  padding: 24px 32px;
  border-left: 4px solid var(--green);
  background: rgba(34, 197, 94, 0.08);
  border-radius: 12px;
  font-style: italic;
  color: var(--muted);
  font-size: 18px;
  line-height: 1.8;
}

.news-detail-content code {
  background: rgba(34, 197, 94, 0.12);
  padding: 3px 10px;
  border-radius: 6px;
  font-size: 0.9em;
  color: var(--green);
  font-family: 'Courier New', 'Monaco', monospace;
  font-weight: 600;
}

.news-detail-content pre {
  background: rgba(15, 23, 42, 0.9);
  padding: 24px;
  border-radius: 12px;
  overflow-x: auto;
  border: 1px solid var(--border);
  margin: 32px 0;
}

.news-detail-content pre code {
  background: none;
  padding: 0;
  color: var(--fg);
  font-weight: 400;
}

.news-detail-content img {
  max-width: 100%;
  height: auto;
  border-radius: 12px;
  margin: 32px 0;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  border: 1px solid var(--border);
}

/* Article Footer */
.news-detail-footer {
  margin-top: 50px;
  padding-top: 40px;
  border-top: 2px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 20px;
}

.news-detail-back-btn {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 14px 28px;
  background: var(--card);
  border: 2px solid var(--border);
  border-radius: 12px;
  color: var(--fg);
  font-weight: 600;
  font-size: 15px;
  text-decoration: none;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.news-detail-back-btn:hover {
  transform: translateY(-2px);
  border-color: var(--green);
  background: rgba(34, 197, 94, 0.08);
  box-shadow: 0 4px 16px rgba(22, 163, 74, 0.2);
  color: var(--green);
}

.news-detail-back-btn::before {
  content: '←';
  font-size: 18px;
  transition: transform 0.3s ease;
}

.news-detail-back-btn:hover::before {
  transform: translateX(-4px);
}

.news-detail-share {
  display: flex;
  gap: 12px;
  align-items: center;
}

.news-detail-share-label {
  font-size: 14px;
  color: var(--muted);
  font-weight: 600;
  margin-right: 8px;
}

.news-detail-share-btn {
  width: 44px;
  height: 44px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--fg);
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  transition: all 0.3s ease;
  font-size: 18px;
}

.news-detail-share-btn:hover {
  background: var(--green);
  border-color: var(--green);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
}

/* Sidebar */
.news-detail-sidebar {
  display: flex;
  flex-direction: column;
  gap: 30px;
}

.news-detail-sidebar-widget {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 28px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
}

.news-detail-sidebar-title {
  font-size: 20px;
  font-weight: 700;
  margin: 0 0 20px 0;
  color: var(--fg);
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border);
}

.news-detail-sidebar-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.news-detail-sidebar-item {
  display: flex;
  gap: 12px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
}

.news-detail-sidebar-item:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

.news-detail-sidebar-item-image {
  width: 80px;
  height: 60px;
  object-fit: cover;
  border-radius: 8px;
  flex-shrink: 0;
}

.news-detail-sidebar-item-content {
  flex: 1;
  min-width: 0;
}

.news-detail-sidebar-item-title {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.4;
  margin: 0 0 6px 0;
  color: var(--fg);
}

.news-detail-sidebar-item-title a {
  color: inherit;
  text-decoration: none;
  transition: color 0.2s ease;
}

.news-detail-sidebar-item-title a:hover {
  color: var(--green);
}

.news-detail-sidebar-item-date {
  font-size: 12px;
  color: var(--muted);
}

/* Reading Progress Bar */
.reading-progress {
  position: fixed;
  top: 0;
  left: 0;
  width: 0%;
  height: 3px;
  background: linear-gradient(90deg, var(--green) 0%, #22c55e 100%);
  z-index: 9999;
  transition: width 0.1s ease;
  box-shadow: 0 2px 8px rgba(22, 163, 74, 0.4);
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Responsive */
@media (max-width: 1200px) {
  .news-detail-layout {
    grid-template-columns: 1fr;
    gap: 40px;
  }

  .news-detail-sidebar {
    order: -1;
  }
}

@media (max-width: 768px) {
  .news-detail-layout {
    padding: 20px 16px;
    gap: 30px;
  }

  .news-detail-header-section {
    padding: 30px 16px 24px;
    margin-bottom: 30px;
  }

  .news-detail-title {
    font-size: 32px;
  }

  .news-detail-meta {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
    padding: 16px 0;
  }

  .news-detail-content {
    padding: 40px 28px;
    font-size: 18px;
  }

  .news-detail-content p {
    font-size: 18px;
    text-align: left;
    margin-bottom: 24px;
  }

  .news-detail-content h1 {
    font-size: 30px;
    margin-top: 48px;
  }

  .news-detail-content h2 {
    font-size: 26px;
    margin-top: 40px;
  }

  .news-detail-content h3 {
    font-size: 24px;
    margin-top: 36px;
  }

  .news-detail-content li {
    font-size: 18px;
  }

  .news-detail-footer {
    flex-direction: column;
    align-items: stretch;
  }

  .news-detail-back-btn {
    width: 100%;
    justify-content: center;
  }

  .news-detail-share {
    width: 100%;
    justify-content: center;
  }
}

@media (max-width: 480px) {
  .news-detail-title {
    font-size: 26px;
  }

  .news-detail-content {
    padding: 32px 20px;
    font-size: 17px;
  }

  .news-detail-content p {
    font-size: 17px;
  }

  .news-detail-content h1 {
    font-size: 26px;
  }

  .news-detail-content h2 {
    font-size: 24px;
  }

  .news-detail-content h3 {
    font-size: 22px;
  }
}
</style>

<!-- Reading Progress Bar -->
<div class="reading-progress" id="reading-progress"></div>

<script>
// Reading progress bar
window.addEventListener('scroll', function() {
  const article = document.querySelector('.news-detail-content');
  if (!article) return;
  
  const articleTop = article.offsetTop;
  const articleHeight = article.offsetHeight;
  const windowHeight = window.innerHeight;
  const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
  
  const articleBottom = articleTop + articleHeight;
  const viewportTop = scrollTop;
  const viewportBottom = scrollTop + windowHeight;
  
  let progress = 0;
  
  if (viewportBottom < articleTop) {
    progress = 0;
  } else if (viewportTop > articleBottom) {
    progress = 100;
  } else {
    const visibleHeight = Math.min(viewportBottom, articleBottom) - Math.max(viewportTop, articleTop);
    progress = (visibleHeight / articleHeight) * 100;
    const scrolled = Math.max(0, viewportTop - articleTop);
    progress = Math.min(100, (scrolled / articleHeight) * 100);
  }
  
  document.getElementById('reading-progress').style.width = progress + '%';
});
</script>

<div class="news-detail-wrapper">
  <!-- Breadcrumbs -->
  <div class="news-detail-breadcrumbs">
    <a href="/">Trang chủ</a>
    <span>/</span>
    <a href="/news">Tin tức</a>
    <span>/</span>
    <span><%= post.title.length > 50 ? post.title.slice(0, 50) + '...' : post.title %></span>
  </div>

  <!-- Header Section -->
  <div class="news-detail-header-section">
    <span class="news-detail-category">Tin tức</span>
    <h1 class="news-detail-title"><%= post.title %></h1>
    
    <div class="news-detail-meta">
      <span class="news-detail-meta-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <%= new Date(post.created_at).toLocaleDateString('vi-VN', { day: 'numeric', month: 'short', year: 'numeric' }) %>
      </span>
      <% if (post.author) { %>
        <span class="news-detail-meta-item">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <%= post.author %>
        </span>
      <% } %>
    </div>
  </div>

  <!-- Main Layout -->
  <div class="news-detail-layout">
    <!-- Main Content -->
    <article class="news-detail-main">
      <!-- Featured Image -->
  <% if (post.thumbnail) { %>
        <div class="news-detail-image-section">
          <div class="news-detail-image-wrapper">
            <img
              src="<%= post.thumbnail %>"
              alt="<%= post.title %>"
              class="news-detail-image"
              loading="eager"
              decoding="async"
            />
          </div>
        </div>
  <% } %>

      <!-- Article Content -->
      <div class="news-detail-content">
        <% if (post.formattedContent) { %>
          <%- post.formattedContent %>
        <% } else if (post.content) { %>
          <% 
            // Fallback: format content if formattedContent is not available
            const content = post.content || '';
            const paragraphs = content.split(/\n\n+/).filter(p => p.trim());
            if (paragraphs.length === 1) {
              // Single paragraph, split by single newlines
              const lines = content.split(/\n/).filter(l => l.trim());
              lines.forEach(line => {
          %>
            <p><%= line.replace(/\n/g, '<br>') %></p>
          <% 
              });
            } else {
              // Multiple paragraphs
              paragraphs.forEach(para => {
                const trimmed = para.trim();
                if (trimmed.startsWith('# ')) {
          %>
            <h2><%= trimmed.substring(2).trim() %></h2>
          <% 
                } else if (trimmed.startsWith('## ')) {
          %>
            <h3><%= trimmed.substring(3).trim() %></h3>
          <% 
                } else {
          %>
            <p><%= trimmed.replace(/\n/g, '<br>') %></p>
          <% 
                }
              });
            }
          %>
  <% } %>
      </div>

      <!-- Footer Actions -->
      <div class="news-detail-footer">
        <a href="/news" class="news-detail-back-btn">
          Quay lại danh sách tin tức
        </a>
        
        <div class="news-detail-share">
          <span class="news-detail-share-label">Chia sẻ:</span>
          <a href="https://www.facebook.com/sharer/sharer.php?u=<%= encodeURIComponent('http://localhost:3000/news/' + post.slug) %>" target="_blank" class="news-detail-share-btn" title="Chia sẻ lên Facebook">FB</a>
          <a href="https://twitter.com/intent/tweet?url=<%= encodeURIComponent('http://localhost:3000/news/' + post.slug) %>&text=<%= encodeURIComponent(post.title) %>" target="_blank" class="news-detail-share-btn" title="Chia sẻ lên Twitter">TW</a>
          <a href="https://www.linkedin.com/shareArticle?url=<%= encodeURIComponent('http://localhost:3000/news/' + post.slug) %>&title=<%= encodeURIComponent(post.title) %>" target="_blank" class="news-detail-share-btn" title="Chia sẻ lên LinkedIn">IN</a>
        </div>
      </div>
    </article>

    <!-- Sidebar -->
    <aside class="news-detail-sidebar">
      <% if (typeof relatedPosts !== 'undefined' && relatedPosts && relatedPosts.length > 0) { %>
        <div class="news-detail-sidebar-widget">
          <h3 class="news-detail-sidebar-title">Bài viết liên quan</h3>
          <ul class="news-detail-sidebar-list">
            <% relatedPosts.forEach(related => { %>
              <li class="news-detail-sidebar-item">
                <% if (related.thumbnail) { %>
                  <img src="<%= related.thumbnail %>" alt="<%= related.title %>" class="news-detail-sidebar-item-image" loading="lazy" />
                <% } else { %>
                  <div class="news-detail-sidebar-item-image" style="background: linear-gradient(135deg, rgba(22, 163, 74, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%);"></div>
                <% } %>
                <div class="news-detail-sidebar-item-content">
                  <h4 class="news-detail-sidebar-item-title">
                    <a href="/news/<%= related.slug %>"><%= related.title %></a>
                  </h4>
                  <div class="news-detail-sidebar-item-date">
                    <%= new Date(related.created_at).toLocaleDateString('vi-VN') %>
                  </div>
                </div>
              </li>
            <% }) %>
          </ul>
        </div>
      <% } %>
      
      <div class="news-detail-sidebar-widget">
        <h3 class="news-detail-sidebar-title">Thông tin</h3>
        <div style="color: var(--muted); font-size: 14px; line-height: 1.8;">
          <p style="margin: 0;">
            <strong style="color: var(--fg);">Ngày đăng:</strong><br/>
            <%= new Date(post.created_at).toLocaleDateString('vi-VN', { year: 'numeric', month: 'long', day: 'numeric' }) %>
          </p>
        </div>
      </div>
    </aside>
  </div>
</div>
